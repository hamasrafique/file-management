<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CloudBox | Next Gen Storage</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>

    <!-- Animated Background Shapes -->
    <div class="bg-shape shape-1"></div>
    <div class="bg-shape shape-2"></div>
    <div class="bg-shape shape-3"></div>

    <div class="container">
        <header>
            <h1>CloudBox</h1>
            <p class="subtitle">Secure. Fast. Infinite.</p>
        </header>

        <!-- Upload Section -->
        <form action="/upload" method="post" enctype="multipart/form-data">
            <div class="upload-area">
                <input type="file" name="file" id="fileInput" required>
                <div class="upload-icon">
                    <i class="fa-solid fa-cloud-arrow-up"></i>
                </div>
                <p class="upload-text">Drag & Drop your files here</p>
                <p class="upload-hint">or click to browse</p>
            </div>

            <button type="submit" class="btn-upload">
                <i class="fa fa-rocket"></i> Upload File
            </button>
        </form>

        <br>

        <!-- File List Section -->
        <div class="file-list-section">
            <div class="file-list-header">
                <h3><i class="fa-solid fa-folder-open"></i> Your Files</h3>
            </div>

            {% if files %}
            <ul class="file-list">
                {% for file in files %}
                <li class="file-item">
                    <div class="file-info">
                        {% if file.name.lower().endswith(('.png', '.jpg', '.jpeg', '.gif', '.webp')) %}
                        <div class="file-preview">
                            <img src="/preview/{{ file.id }}" alt="{{ file.name }}">
                        </div>
                        {% else %}
                        <i class="fa-solid fa-file-lines file-type-icon"></i>
                        {% endif %}
                        <!-- Updated to use file.name from DB model -->
                        <span class="file-name" title="{{ file.name }}">{{ file.name }}</span>
                    </div>
                    <div class="actions">
                        <!-- Updated to use file.id from DB model -->
                        <a href="/download/{{ file.id }}" class="btn-action btn-download" title="Download">
                            <i class="fa-solid fa-download"></i> <span class="action-text">Download</span>
                        </a>
                        <a href="/delete/{{ file.id }}" class="btn-action btn-delete" title="Delete">
                            <i class="fa-solid fa-trash"></i> <span class="action-text">Delete</span>
                        </a>
                    </div>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <div style="text-align: center; color: var(--text-muted); padding: 20px;">
                <p>No files uploaded yet. Start by uploading one!</p>
            </div>
            {% endif %}
        </div>

        <footer>
            <p>&copy; 2026 CloudBox Project. Designed for the Future.</p>
        </footer>
    </div>

    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>

    <!-- Flash Messages -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer)
                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
            });

            {% with messages = get_flashed_messages(with_categories = true) %}
            {% if messages %}
            {% for category, message in messages %}
            Toast.fire({
                icon: '{{ "success" if category == "success" else "error" }}',
                title: '{{ message }}'
            });
            {% endfor %}
            {% endif %}
            {% endwith %}
        });
    </script>
</body>

</html>